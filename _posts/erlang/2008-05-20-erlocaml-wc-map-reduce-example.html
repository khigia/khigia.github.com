---
layout: post-import
title: "erlocaml wc map-reduce example"
categories: ['wp-import', 'erlang']
wpimport-url: "http://khigia.wordpress.com/2008/05/20/erlocaml-wc-map-reduce-example/"
---
New example in ocamerl lib of <a href="http://code.google.com/p/erlocaml/">erlocaml</a> project: a tiny map-reduce-like (1) word-count program (word-count is the simple example <a href="http://www.michael-noll.com/wiki/Writing_An_Hadoop_MapReduce_Program_In_Python">often</a> <a href="http://code.google.com/edu/parallel/mapreduce-tutorial.html">used</a> to illustrate map-reduce principle).<br/>
<a href="http://code.google.com/p/erlocaml/source/browse/trunk/lib/ocamerl/ex/ex_node_wc.ml?r=51">First part</a> of this example is an ocaml distributed erlang node [<a href="http://code.google.com/p/erlocaml/source/browse/trunk/lib/ocamerl/ex/ex_node_wc.ml?r=51#52">l52</a>]. It is composed of one permanent registered ('wc') mbox [<a href="http://code.google.com/p/erlocaml/source/browse/trunk/lib/ocamerl/ex/ex_node_wc.ml?r=51#40">l40</a>] which upon request create other mboxes implementing the mappers [<a href="http://code.google.com/p/erlocaml/source/browse/trunk/lib/ocamerl/ex/ex_node_wc.ml?r=51#19">l19</a>] (on request, a mapper read a text file [<a href="http://code.google.com/p/erlocaml/source/browse/trunk/lib/ocamerl/ex/ex_node_wc.ml?r=51#8">l8</a>] and send it word by word to reducer [<a href="http://code.google.com/p/erlocaml/source/browse/trunk/lib/ocamerl/ex/ex_node_wc.ml?r=51#29">l29</a>]).<br/>
<a href="http://code.google.com/p/erlocaml/source/browse/trunk/lib/ocamerl/ex/ex_wc.erl?r=51">Second part</a> of this map-reduce example is an erlang module implementing two functionalities. One of them is the reduce part implementation [<a href="http://code.google.com/p/erlocaml/source/browse/trunk/lib/ocamerl/ex/ex_wc.erl?r=51#34">l34</a>] done by a process which accept messages from mappers and update a dictionary accordingly.
Second responsibility of this module is orchestration of the map-reduce flow [<a href="http://code.google.com/p/erlocaml/source/browse/trunk/lib/ocamerl/ex/ex_wc.erl?r=51#90">l90</a>], consisting of running all mappers [<a href="http://code.google.com/p/erlocaml/source/browse/trunk/lib/ocamerl/ex/ex_wc.erl?r=51#66">l66</a>], waiting end of all those executions [<a href="http://code.google.com/p/erlocaml/source/browse/trunk/lib/ocamerl/ex/ex_wc.erl?r=51#79">l79</a>], and collecting result of all reducers [<a href="http://code.google.com/p/erlocaml/source/browse/trunk/lib/ocamerl/ex/ex_wc.erl?r=51#95">l95</a>].<br/>
Assuming EPMD is running, <a href="http://code.google.com/p/erlocaml/source/browse/trunk/lib/ocamerl/test/wc.sh?r=51">this script</a> run an ocaml node and an erlang node, and run a simple map-reduce to count words in two test files.<br/>
As usual, not sure it's a useful example, but it was sure fun to write :)<br/>
<em>(1) this is not a map-reduce lib ... there is no failure case taken care of, processes pipe is mostly done through messages over network (while map-reduce is mainly meant to use an efficient filesystem based communication), etc!</em>